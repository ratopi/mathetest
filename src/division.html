<!DOCTYPE html>
<html>
<head>

	<title>Divisi</title>

	<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>

	<script type="text/javascript">

		var divisi = function()
		{
			return {
				"init": init,
				"nextChallenge": nextChallenge,
				"showTime": showTime
			}                                    
			
			// ---

			var expectedResult;
			var finished;
			var currentInput;
			
			var startTime;
			var correctAnswers;
			var answerCount;

			var runningTime;

			// ---
			
			function init()
			{
				correctAnswers = 0;
				answerCount = 0;
			
				$( "#resultDiv" ).hide();
				runningTime = 5 * 60 * 1000;
			
				nextChallenge();
				
				$( document ).keypress( keypressed );
			}

			function nextChallenge()
			{
				currentInput = "";
				finished = false;
				$( "#message" ).hide();
			
				var b = Math.ceil( Math.random() * 10 );
				var c = Math.ceil( Math.random() * 10 );
				
				var a = b * c;
				
				$( "#numberA" ).text( a );
				$( "#numberB" ).text( b );
				
				expectedResult = c;
				
				showCurrentInput();
			}
			
			function keypressed( event )
			{
				if ( ! startTime )
				{
					startTime = new Date().getTime();
					showTime();
				}
							
				var charCode = event.charCode;
				var keyCode = event.keyCode;
				var asciiCode = event.which;
				
				if ( finished )
				{
					if ( keyCode === 13 )
					{
						nextChallenge();
					}
				}
				else
				{
					if ( charCode >= 48  &&  charCode <= 57 )
					{
						var n = charCode - 48;
						currentInput = currentInput + n;
					}
					else if ( keyCode === 8 )
					{
						if  ( currentInput.length > 0 )
						{
							currentInput = currentInput.substring( 0, currentInput.length - 1 );
						}
					}
					else if ( keyCode === 13 )
					{
						checkResult();
					}
				}
				
				showCurrentInput();
			}
			
			function checkResult()
			{
				if ( currentInput.length === 0 ) return;
			
				answerCount++;
				if ( currentInput == expectedResult )
				{
					$( '#message' ).show().text( "RICHTIG" ).css( "background-color", "green" );
					finished = true;
					correctAnswers++;
				}
				else 
				{
					$( '#message' ).show().html( "* FALSCH! *<br>Richtig ist: " + expectedResult ).css( "background-color", "red" );
					finished = true;
				}
			}
			
			function showCurrentInput()
			{
				$( "#numberC" ).text( currentInput + "_" );
			}
			
			function showTime()
			{
				if ( ! startTime )
				{
					$( "#duration" ).text( "-" );	
				}
				else
				{
					var now = new Date().getTime();
					var duration = now - startTime;
					
					var seconds = Math.floor( duration / 1000 );
					var minutes = Math.floor( seconds / 60 );
					seconds = seconds - minutes * 60;
					if ( seconds < 10 ) seconds = "0" + seconds;
					
					$( "#duration" ).text( minutes + ":" + seconds );

					if ( duration >= runningTime )
					{
						gameOver();
					}
					else
					{
						window.setTimeout( showTime, 1000 );
					}
				}
			}
			
			function gameOver()
			{
				var wrongAnswers = answerCount - correctAnswers;
				$( "#correctAnswers" ).text( correctAnswers );
				$( "#wrongAnswers" ).text( wrongAnswers );
				$( "#answerCount" ).text( answerCount );
				$( "#quota" ).text( ( Math.round( ( correctAnswers / answerCount ) * 10000 ) / 100 ) + "%" );
				
				$( "#challenge" ).hide();
				$( "#resultDiv" ).show();
			}

		}();

		// ---

		$( document ).ready( divisi.init );

	</script>

</head>

<body style="background-color:black; color:white;">

	<span id="duration"></span>

	<div id="challenge" style="font-size:128px; font-weight:bold;">

		<span id="numberA">A</span> : <span id="numberB">B</span> = <span id="numberC">C</span>
		<br>
		<span id="message"></span>
		
	</div>
	
	<div id="resultDiv" style="font-size:32px;">
		<table>
			<tr><td id="correctAnswers"></td><td>Aufgaben korrekt gelöst</td></tr>
			<tr><td id="wrongAnswers"></td><td>Aufgaben falsch gelöst</td></tr>
			<tr><td  id="answerCount"></td><td>Aufgaben insgesamt</td></tr>
			<tr><td id="quota"></td><td>korrekt gelöst</td></tr>
		</table>
	</div>
		
</body>

</html>

